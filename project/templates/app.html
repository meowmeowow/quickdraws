<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>QuickDraws</title>
</head>
<body>
   <div>
   <span id="time"></span>
   <span id="player"class style = "display:none">
      <a href="javascript:action(2)" id="prev"><</a>
      <a href="javascript:action(4)" id="pause" class style = "display: inline;">||</a>
      <a href="javascript:action(3)" id="play" class style = "display: none;">D</a>
      <a href="javascript:action(1)" id="next">></a>
   </span>

   <button class="button" id="stop" onclick="action(5)" class style = "display: none;">STOP</button>
   <button class="button" id="start" onclick="action(6)" class style = "display: inline;">START</button>

</div>


   <img id = "myimg" src="" alt="User Image">

<script>

var imgap = 0;
var images_seen = 0;
var a;
let time_set = (prompt("time in seconds:"))*1000;

setInterval(update_timer, 1000);




   var getInitialImage = new XMLHttpRequest();
   getInitialImage.open("GET", "/getimage");
   getInitialImage.onreadystatechange = function (){
   if (this.readyState == 4 && this.status == 200){
      document.getElementById("myimg").setAttribute("src", "/static/photos/" + this.responseText);
      }
   }
   getInitialImage.send();






function action(ac){
   //forwards
   if (ac == 1){
      imgap += 1
      images_seen++;
            a.pause();
         a = new timer(function() {  action(1);}, time_set);
      var getlastimagedetails = new XMLHttpRequest();
      getlastimagedetails.open("GET", "/getimage?num=" + imgap.toString());
      getlastimagedetails.onreadystatechange = function (){
      if (this.readyState == 4 && this.status == 200){
      document.getElementById("myimg").setAttribute("src", "/static/photos/" + this.responseText);
         }
      }
      getlastimagedetails.send();


   }
   //backwards
   if (ac == 2){

      imgap += -1
      images_seen++;
            a.pause();

         a = new timer(function() {  action(1);}, time_set);
      var getlastimagedetails = new XMLHttpRequest();
      getlastimagedetails.open("GET", "/getimage?num=" + imgap.toString());
      getlastimagedetails.onreadystatechange = function (){
      if (this.readyState == 4 && this.status == 200){
      document.getElementById("myimg").setAttribute("src", "/static/photos/" + this.responseText);
         }
      }
      getlastimagedetails.send();

   }

   if(ac == 3){
      //start timer

      a.start();


      document.getElementById("pause").style.display = "inline";
      document.getElementById("play").style.display = "none";





   }
   if(ac == 4){
      //pause timer
      a.pause();
      document.getElementById("pause").style.display = "none";
      document.getElementById("play").style.display = "inline";


   }

   if(ac ==5){
      //stop
      a.pause();
      alert("session ended " + (images_seen+1)+ " image's viewed");
      location.reload() 

   }
   if(ac == 6){
      //start

      document.getElementById("start").style.display = "none";
      document.getElementById("stop").style.display = "inline";
      document.getElementById("player").style.display = "inline";

               a = new timer(function() {  action(1);}, time_set);


   }
}


function timer(callback, delay) {
    var id, started, remaining = delay, running

    this.start = function() {
        running = true
        started = new Date()
        id = setTimeout(callback, remaining)
    }

    this.pause = function() {
        running = false
        clearTimeout(id)
        remaining -= new Date() - started
    }

    this.getTimeLeft = function() {
        if (running) {
            this.pause()
            this.start()
        }

        return remaining
    }

    this.getStateRunning = function() {
        return running
    }

    this.start()
}



function update_timer(){
      document.getElementById("time").innerHTML = "Time left:"+ parseInt(a.getTimeLeft()/1000);
}




</script>   





</body>
</html>