{% extends "base.html" %}

{% block content %}

   <span id="time"></span>

   <h1 class="title">Constraints</h1>
   

<div>
    <select id='timeForm' class="button">
      <option value="15000"> 15 seconds </option>
      <option value="30000"> 30 seconds </option>
      <option value="60000"> 1 minute </option>
      <option value="120000"> 2 minutes </option>
      <option value="180000"> 3 minutes </option>
      <option value="300000"> 5 minutes </option>
      <option value="420000"> 7 minutes </option>
      <option value="600000"> 10 minutes </option>
      <option value="900000"> 15 minutes </option>
    </select>
  </div>

<button class="button" id="start" onclick="redirectAndStartTimer()" class style = "display: inline;">START</button>


<script>
  var a;
  var time_set= 15000; //defaults to 15sec

  setInterval(update_timer, 1000);

  getInitialImage.send();

  document.getElementById('timeForm').addEventListener('change', function() {
      time_set = parseInt(this.value);
  });

  function redirectAndStartTimer() {
    window.location.href = "{{ url_for('main.index') }}";
    localStorage.setItem('startTimer', true);
    localStorage.setItem('timeSet', time_set);
}

  function act(ac) {
      if(ac == 6) {
	  //start

	  document.getElementById("start").style.display = "none";
	  document.getElementById("stop").style.display = "inline";
	  document.getElementById("player").style.display = "inline";

      
	  a = new timer(function() {  act(1);}, time_set);
      }
  }


  function timer(callback, delay) {
      var id, started, remaining = delay, running

      this.start = function() {
          running = true
          started = new Date()
          id = setTimeout(callback, remaining)
      }

      this.pause = function() {
          running = false
          clearTimeout(id)
          remaining -= new Date() - started
      }

      this.getTimeLeft = function() {
          if (running) {
              this.pause()
              this.start()
          }

          return remaining
      }

      this.getStateRunning = function() {
          return running
      }

      this.start()
  }

  function update_timer(){
      if(a) {
	  document.getElementById("time").innerHTML = "Time left:"+ parseInt(a.getTimeLeft()/1000); 
      } else {
	  document.getElementById("time").innerHTML = "";
      }
  }


</script>   



{% endblock %}